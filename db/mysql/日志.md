

---

#### 双1安全参数



1. **两阶段提交（2PC）**： 第一步：写redo log，处于prepare阶段；第二步：写binlog；第三步：commit事务；
2. redo log与binlog都需要能够完整的重演数据库操作逻辑，先写哪一个都有问题，因此使用2PC解决两个log的状态不一致问题；
3. **控制粒度：每次提交事务**；



1. 事务执行时，binlog会先写入到binlog cache，事务提交时，再把binlog cache写到binlog文件中；
2. write是指将日志写入到文件系统的page cache，但并没有将数据持久化到磁盘；
3. fsync才是真正将数据持久化到磁盘的，一般情况下，我们认为fsync才占用磁盘的IOPS；



|      | innodb_flush_log_at_trx_commit                               | sync_binlog                                                  |
| ---- | :----------------------------------------------------------- | ------------------------------------------------------------ |
| 对象 | redo log                                                     | binlog                                                       |
| 粒度 | **按事务**                                                   | **按事务**                                                   |
| 描述 | 1. 先写redo log buffer<br />2. 不一定会write到page cache<br />3. 每秒后台轮询fsync | 1. 先写binlog cache<br />2. 提交事务至少会write到page cache<br />3. 每 0, 1, N 次事务调用fsync一次 |
|      |                                                              |                                                              |
| 0    | redo log buffer                                              | write到page cache                                            |
| 1    | **fsync到磁盘**                                              | **fsync到磁盘**                                              |
| 2/N  | write到page cache                                            | 1. write到page cache，每N次事务调用fsync<br />2. 如果主机意外重启，会丢失最近N个事务的binlog日志 |



---

#### redo  log 满血复活

1. 重做日志，InnoDB特有，crash safe
2. 物理日志，记录“在某个数据页上做了什么修改”
3. 循环写，顺序写，组提交
4. WAL：write ahead logging
5. 



----

#### binlog  影分身

1. 归档日志，由mysql的server层实现，所有引擎都可以使用
2. 逻辑日志，记录的是这个语句的原始逻辑，比如“给 ID=2 这一行的 c 字段加 1 ”
3. 追加写



----

#### undo log 回滚

1. 