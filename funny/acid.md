----
#### 0x00 Abstract

世人皆知，事务（transaction）具有ACID特性，但ACID具体指啥，似乎能说上来，但好像又说不太明白。

我们从你加班肚子饿了，进餐馆吃饭说起：

----

#### 0x01 Atomicity（原子性）

你到餐馆吃饭，**点菜、上菜、吃菜是一整套流程**。这些流程就是一个完整的事务，一气呵成才能吃饱，缺了哪步都不行。假如你点完菜了，但是老板突然告诉你说：“不好意思，先生，您点的米饭没有了，要不您换一个”。你很生气，非常生气，一拍桌子：“老子不吃了”，然后走人。得，菜白点了，跟没点一样，可不就是相当于把事务回滚（Rollback）了嘛。你**换个餐馆，还得重新来一遍：点菜、上菜、吃菜，少了哪一个你都没得吃**。

因此，原子性是指：一个事务中的所有操作，要么全完成，要么全不做，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚到事务开始前的状态，就像这个事务从来没有执行过一样。

----

#### 0x02 Consistency（一致性）

你在餐馆吃的饭菜一定在你肚子里，而且你应该吃饱了。不可能你没吃就饱了，也不可能你吃了肚子没饱反而你撑死了（万一发生了，那就是家黑店，请自行投诉）。也就是说，**事情发展的结果必须合情合理，不灵异、不异常**。

因此，一致性是指：在事务开始之前和事务结束以后，数据库的完整性没有被破坏。这表示写入的资料必须完全符合所有的预设规则，这包含资料的精确度、串联性以及后续数据库可以自发性地完成预定的工作。

----

#### 0x03 Isolation（隔离性）

你因为加班发了财，这次去餐馆吃饭，跟平时不一样，你大手一挥：VIP包场。你进去之后，**把门一锁，整个餐馆只为你一个人服务**。那体验，当然是很爽，点啥立马上，绝不拖延，只有一样，得给钱，得给大把的钱，一张毛爷爷不够。

ACID四大特性中，其它三大特性都是基于log（日志）实现，只有隔离性不行，它需要用锁（lock）。隔离性通过使用锁门的方法做到了事务执行的时候，让每个事务（顾客）都觉得自己是整个系统（餐馆）唯一的顾客。凭什么呢，就凭你**包了场的，锁了门的，付了更多的钱的**，所以隔离性的代价是非常高昂的。

因此，隔离性是指：数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括读未提交（Read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（Serializable）。

----

#### 0x04 Durability（持久性）

也就是餐馆里的饭，你吃了就是吃了，**即使你挂了，仵作也能在你肚子里找到那些饭**。

因此，持久性是指：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。

----

#### 0x05 ACID特性的实现

事务的ACID特性是由数据库管理系统（DBMS）实现的。其中的三大特性（原子性、一致性、持久性）都是基于log（日志）来实现。log记录了事务对DB所做的更新，如果某个事务在执行过程中发生错误，就可以根据log，撤销事务对DB已做的更新，使DB退回到执行事务前的初始状态。

只有隔离性需要用到锁。当多个事务同时更新数据库中相同的数据时，只允许持有锁的事务能更新该数据，其他事务必须等待，直到前一个事务释放了锁，其他事务才有机会更新该数据。

---

#### 0x06 References

1. [wiki:ACID](https://zh.wikipedia.org/wiki/ACID)
2. [事务的ACID特性(云开见月明)](https://zhuanlan.zhihu.com/p/27789602)
3. [事务的ACID特性](http://www.cnblogs.com/wangchuanqi/p/5554708.html)